$PBJQ("#footerAppPresence").on("click",function(){$PBJQ("#presenceArea").toggleClass("is-hidden")
});
$PBJQ("details").details();
$PBJQ(document).ready(function(){updateFooterTime=(function(){if($PBJQ("#preferredTime").length==1){var c=$PBJQ("#preferredTime").data("preferredtzdisplay");
var e=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")));
var a=e.getTime()-(new Date()).getTime()
}var b=$PBJQ("#serverTime").data("servertzdisplay");
var d=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")));
var f=d.getTime()-(new Date()).getTime();
return function(){var g=new Date((new Date()).getTime()+f);
var h=g.toUTCString().replace(/GMT/,b).replace(/UTC/,b);
$PBJQ("#serverTime").text(h);
if($PBJQ("#preferredTime").length==1){var g=new Date((new Date()).getTime()+a);
var h=g.toUTCString().replace(/GMT/,c).replace(/UTC/,c);
$PBJQ("#preferredTime").text(h)
}setTimeout("updateFooterTime()",1000)
}
})();
if($PBJQ("#serverTime").length==1){updateFooterTime()
}});
var dhtml_view_sites=function(){$PBJQ("#selectSiteModal").addClass("dhtml_more_tabs");
$PBJQ(".more-tab").position();
dhtml_view_sites=function(){var e=$PBJQ("#selectSiteModal");
e.show();
if(e.hasClass("outscreen")){$PBJQ("body").toggleClass("active-more-sites");
if($PBJQ("body").hasClass("toolsNav--displayed")){toggleToolsNav()
}var a=$PBJQ(".view-all-sites-btn:visible");
var d=10;
if(a.length>0){a.css("z-index",1005);
var c=a.offset().top+a.outerHeight()+d;
var f=$PBJQ("body").outerWidth()-(a.offset().left+a.outerWidth());
if($PBJQ("html").attr("dir")!=="rtl"){e.css("top",c).css("right",f)
}else{e.css("top",c).css("left",$PBJQ("body").outerWidth()-f)
}}e.toggleClass("outscreen");
var b=$PBJQ(window).height();
b-=$PBJQ(".tab-pane").offset().top;
b-=parseInt(e.css("padding-bottom"),10);
$PBJQ(".tab-pane").css("max-height",b);
$PBJQ("#txtSearch").focus();
createDHTMLMask(dhtml_view_sites);
$PBJQ(".selectedTab").bind("click",function(g){dhtml_view_sites();
return false
});
$PBJQ(".tab-pane:first").focus();
$PBJQ(document).trigger("view-sites-shown")
}else{$PBJQ("body").toggleClass("active-more-sites");
$PBJQ("#selectSiteModal").toggleClass("outscreen");
var a=$PBJQ(".view-all-sites-btn");
a.css("z-index","auto");
$PBJQ("#selectSite").attr("tabindex","-1");
removeDHTMLMask();
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click")
}};
dhtml_view_sites()
};
function closeDrawer(){$PBJQ("#selectSiteModal").toggleClass("outscreen");
removeDHTMLMask();
$PBJQ("#selectSite").attr("tabindex","-1");
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click");
$PBJQ(".moreSitesLink").unbind("keydown");
$PBJQ(".more-tab a").focus()
}function createDHTMLMask(a){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>');
$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1000,top:0,left:0}).bind("click",function(b){a();
return false
});
$PBJQ("#portalMask").bgiframe()
}function removeDHTMLMask(){$PBJQ("#portalMask").remove()
}function showToolMenu(h){var g=h.attr("id");
var a=g.replace(/!/g,"\\!").replace(/~/g,"\\~");
$PBJQ(".toolMenus").removeClass("toolMenusActive");
if($PBJQ("."+a).length){$PBJQ("#otherSiteTools").remove()
}else{var c=$PBJQ('<ul id="otherSiteTools" role="menu" />').addClass(g);
var f="/direct/site/"+g+"/pages.json";
scroll(0,0);
var e=parseInt($PBJQ("#maxToolsInt").text());
var d=$PBJQ("#maxToolsText").text();
var i=$PBJQ('<li class="otherSiteTool" ><span><a role="menuitem"><span class="Mrphs-toolsNav__menuitem--icon"> </span></a></span></li>');
var b=i.clone();
b.find("a").attr("href",portal.portalPath+"/site/"+g).attr("title",d).append(d);
b.find("a span").addClass("icon-sakai--see-all-tools");
$PBJQ.getJSON(f,function(j){$PBJQ.each(j,function(l,m){if(!m.tools[0]){return true
}if(l<e){var k=i.clone();
k.find("a").attr("href",m.tools[0].url).attr("title",m.title).append(m.title);
k.find("a span").addClass("icon-"+m.tools[0].toolId.replace(/\./gi,"-")).addClass("otherSiteToolIcon");
if(m.toolpopup){k.find("a").attr("href",m.tools[0].url+"?sakai.popup=yes").attr("onclick","window.open("+m.toolpopupurl+"); return false")
}c.append(k)
}});
if(j.length>e){c.append(b.clone())
}$PBJQ("#otherSiteTools").remove();
h.closest("li").append(c);
h.parent().find(".toolMenus").addClass("toolMenusActive")
})
}}$PBJQ(document).ready(function(){if($PBJQ("#eid").length===1){$PBJQ("#eid").focus()
}$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",dhtml_view_sites);
$PBJQ("#show-all-sites, .view-all-sites-btn").on("click",dhtml_view_sites);
var b=portal.siteTitle;
if(b){if(portal.shortDescription){b=b+" ("+portal.shortDescription+")"
}$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+b+":</span> ")
}$PBJQ("#txtSearch").keyup(function(d){if(d.keyCode==27){a()
}if($PBJQ("#txtSearch").val().length>0){var e=$PBJQ("#txtSearch").val().toLowerCase();
$PBJQ(".fav-sites-term, .fav-sites-entry").hide();
var c=$PBJQ(".fav-sites-entry").filter(function(f,g){return($PBJQ(".fav-title a",g).attr("title").toLowerCase().indexOf(e)>=0)
});
c.show();
c.closest(".fav-sites-term").show()
}if($PBJQ("#txtSearch").val().length==0){a()
}if($PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1){$PBJQ(".norecords").remove();
$PBJQ("#noSearchResults").fadeIn("slow")
}});
function a(){$PBJQ("#txtSearch").val("");
$PBJQ(".fav-sites-term, .fav-sites-entry").show();
$PBJQ("#noSearchResults").hide();
$PBJQ("#txtSearch").focus()
}$PBJQ("#otherSiteSearchClear").on("click",function(){a()
});
$PBJQ("#presenceToggle").click(function(c){c.preventDefault();
$PBJQ("#presenceArea").toggle()
});
$PBJQ(".trayPopupClose").click(function(c){c.preventDefault();
$PBJQ(this).closest(".trayPopup").hide()
});
if($PBJQ("a.tool-directurl").length){$PBJQ("a.tool-directurl").cluetip({local:true,arrows:true,cluetipClass:"jtip",sticky:true,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})
}});
$PBJQ(document).ready(function(i){var a=[];
var f=false;
var b=$PBJQ("#selectSite");
var m=$PBJQ("#otherSitesCategorWrap");
var c=$PBJQ("#organizeFavorites");
var j={};
$PBJQ(".site-favorite-btn",m).each(function(q,r){j[$PBJQ(r).data("site-id")]=$PBJQ(r).parent()
});
var p={favorite:{markup:'<i class="site-favorite-icon site-favorite"></i>'},nonfavorite:{markup:'<i class="site-favorite-icon site-nonfavorite"></i>'},myworkspace:{markup:'<i class="site-favorite-icon site-workspace site-favorite"></i>'}};
var h=function(q){$PBJQ.ajax({url:"/portal/favorites/list",method:"GET",dataType:"text",success:function(r){a=r.split(";").filter(function(t,s){return t!=""
});
q(a)
}})
};
var e=function(q,s){var r=p[s];
$PBJQ(q).data("favorite-state",s);
if(s==="favorite"){$PBJQ(q).attr("title",$PBJQ("#removeFromFavoritesText").text())
}else{if(s==="nonfavorite"){$PBJQ(q).attr("title",$PBJQ("#addToFavoritesText").text())
}else{$PBJQ(q).attr("title",null)
}}$PBJQ(q).empty().append($PBJQ(r.markup))
};
var d=function(){var q=$PBJQ(".site-favorite",m).length;
$PBJQ(".favoriteCount",b).text("("+q+")");
if(q<2){$PBJQ(".organizeFavorites",b).addClass("tab-disabled")
}else{$PBJQ(".organizeFavorites",b).removeClass("tab-disabled")
}};
var n=function(q){$PBJQ(".site-favorite-btn",m).each(function(r,s){var t=$PBJQ(s).data("site-id");
if($PBJQ(s).closest(".my-workspace").length>0){e(s,"myworkspace")
}else{if($PBJQ.inArray(t,q)>=0){e(s,"favorite")
}else{e(s,"nonfavorite")
}}});
d();
f=true
};
var o=function(){return $PBJQ(".site-favorite-btn",m).has(".site-favorite").map(function(){return $PBJQ(this).data("site-id")
}).toArray()
};
var k=function(){h(n)
};
var l=function(){if($PBJQ(".moresites-refresh-notification").length>0){return
}var q=$PBJQ('<div class="moresites-refresh-notification" />').html($PBJQ("#refreshNotificationText").html());
$PBJQ("#loginLinks").prepend(q);
q.css("top",($PBJQ(".Mrphs-siteHierarchy").offset().top)+"px")
};
var g=function(r){if(!f){console.log("Can't update favorites as they haven't been loaded yet.");
return
}if(!r){r=function(){}
}var q=o();
q=q.sort(function(t,s){if(a.indexOf(t)===-1){return 1
}else{if(a.indexOf(s)===-1){return -1
}else{return a.indexOf(t)-a.indexOf(s)
}}});
$PBJQ.ajax({url:"/portal/favorites/update",method:"POST",data:{favorites:q.join(";")},error:r});
a=q;
l()
};
$PBJQ(m).on("click",".site-favorite-btn",function(){var r=this;
var t=$PBJQ(r).data("site-id");
var q=$PBJQ(r).data("favorite-state");
if(q==="myworkspace"){return
}var s;
if(q==="favorite"){s="nonfavorite"
}else{s="favorite"
}e(r,s);
d();
g(function(){k()
})
});
$PBJQ(b).on("click",".tab-btn",function(){if($PBJQ(this).hasClass("tab-disabled")){return false
}$PBJQ(".tab-btn",b).removeClass("active");
$PBJQ(this).addClass("active");
var q=$PBJQ(this).data("tab-target");
$PBJQ(".tab-box").hide();
$PBJQ(b).trigger("tab-shown",q);
$PBJQ("#"+q).show()
});
$PBJQ(document).on("view-sites-shown",function(){k()
});
$PBJQ(b).on("tab-shown",function(s,q){if(q==="organizeFavorites"){var r=$PBJQ("#organizeFavoritesList");
r.empty();
$PBJQ("#otherSiteTools").remove();
$PBJQ("#organizeFavoritesPurgatoryList").empty();
$PBJQ.each(a,function(u,w){if(!j[w]){return
}if($PBJQ(j[w]).hasClass("my-workspace")){return
}var v=j[w].clone(false);
v.addClass("organize-favorite-item").data("site-id",w);
var t=$PBJQ('<i class="fa fa-bars fav-drag-handle"></i>');
$PBJQ(".toolMenus",v).remove();
v.append(t);
$PBJQ(v).find(".fav-title a").attr("href",null);
r.append(v);
v.show()
});
r.sortable({stop:function(){a=r.find(".organize-favorite-item").map(function(){return $PBJQ(this).data("site-id")
}).toArray();
g()
}});
r.disableSelection()
}});
$PBJQ(m).on("click",".toolMenus",function(q){q.preventDefault();
showToolMenu($PBJQ(this));
return false
});
$PBJQ(c).on("click",".site-favorite-btn",function(){var s=this;
if($PBJQ(s).closest(".my-workspace").length>0){return
}var q=$PBJQ(s).parent();
var r;
if($PBJQ(s).closest("#organizeFavoritesList").length==0){$PBJQ("#organizeFavoritesList").append(q);
r="favorite"
}else{$PBJQ("#organizeFavoritesPurgatoryList").append(q);
r="nonfavorite"
}e(s,r);
e(j[$PBJQ(s).data("site-id")].find(".site-favorite-btn"),r);
d();
g(function(){k()
})
});
$PBJQ(".otherSitesMenuClose").on("click",function(){dhtml_view_sites()
})
});
var profile=profile||{};
profile.requestFriend=function(b,a){$PBJQ.ajax({url:"/direct/profile/"+b+"/requestFriend?friendId="+a,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-unconnected-block-"+a).hide();
$PBJQ("#profile-popup-requested-block-"+a).show()
});
return false
};
profile.confirmFriendRequest=function(b,a){$PBJQ.ajax({url:"/direct/profile/"+b+"/confirmFriendRequest?friendId="+a,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-incoming-block-"+a).hide();
$PBJQ("#profile-popup-connected-block-"+a).show()
});
return false
};
profile.removeFriend=function(a,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/removeFriend?friendId="+b,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-connected-block-"+b).hide();
$PBJQ("#profile-popup-unconnected-block-"+b).show()
});
return false
};
profile.ignoreFriendRequest=function(a,b){$PBJQ.ajax({url:"/direct/profile/"+a+"/ignoreFriendRequest?friendId="+b,dataType:"text",cache:false}).done(function(d,e,c){$PBJQ("#profile-popup-requested-block-"+b).hide();
$PBJQ("#profile-popup-incoming-block-"+b).hide();
$PBJQ("#profile-popup-unconnected-block-"+b).show()
});
return false
};
function publishSite(b){var a="/direct/site/"+b+"/edit";
var c=$PBJQ.ajax({type:"POST",data:"published=true",url:a,success:function(){location.reload()
}}).responseText
}function quickLinksNavEscHandler(a){if(a.keyCode===27){toggleQuickLinksNav(a)
}}function toggleQuickLinksNav(b){b.preventDefault();
if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){toggleUserNav(b)
}$PBJQ(".Mrphs-quickLinksNav__subnav").toggleClass("is-hidden");
if(!$PBJQ(".Mrphs-quickLinksNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="quicklinks-dropdown-overlay" />');
a.on("click",function(c){toggleQuickLinksNav(c)
});
$PBJQ("body").prepend(a);
$PBJQ(document).on("keyup",quickLinksNavEscHandler)
}else{$PBJQ(".quicklinks-dropdown-overlay").remove();
$PBJQ(document).off("keyup",quickLinksNavEscHandler)
}}$PBJQ("#quickLinks-close").on("click",toggleQuickLinksNav);
$PBJQ(".js-toggle-quick-links-nav").on("click",toggleQuickLinksNav);
function toggleToolsNav(a){if(a){a.preventDefault()
}$PBJQ("body").toggleClass("toolsNav--displayed")
}$PBJQ(document).ready(function(){$PBJQ("i.clickable","#roleSwitch").click(function(){$PBJQ(this).next("select").toggleClass("active")
});
$PBJQ("#roleSwitchSelect").on("change",function(){if($PBJQ("option:selected",this).text()!==""){document.location=$PBJQ("option:selected",this).val()
}else{$PBJQ(this)[0].selectedIndex=0
}})
});
$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);
var sessionId="current";
var sessionTimeOut;
var timeoutDialogEnabled=false;
var timeoutDialogWarningTime;
var timeoutLoggedoutUrl;
var timeoutPortalPath;
$PBJQ(document).ready(function(){if(portal.loggedIn&&portal.timeoutDialog){setTimeout("setup_timeout_config();",60000)
}});
var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;
timeoutDialogWarningTime=portal.timeoutDialog.seconds;
timeoutLoggedoutUrl=portal.loggedOutUrl;
timeoutPortalPath=portal.portalPath;
if(timeoutDialogEnabled==true){poll_session_data();
fetch_timeout_dialog()
}};
var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date()).getTime(),dataType:"json",success:function(b){b.maxInactiveInterval=b.maxInactiveInterval*1000;
if(b.active&&b.userId!=null&&b.lastAccessedTime+b.maxInactiveInterval>b.currentTime){var a=b.lastAccessedTime+b.maxInactiveInterval-b.currentTime;
if(a<timeoutDialogWarningTime*1000){min=Math.round(a/(1000*60));
show_timeout_alert(min);
clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",1000*60)
}else{clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",(a-timeoutDialogWarningTime*1000))
}}else{if(b.userId==null){location.href=timeoutLoggedoutUrl
}else{sessionTimeOut=setTimeout("poll_session_data()",1000*10)
}}},error:function(c,a,b){}})
};
function keep_session_alive(){dismiss_session_alert();
$PBJQ.get(timeoutPortalPath)
}var dismiss_session_alert=function(){removeDHTMLMask();
$PBJQ("#timeout_alert_body").remove()
};
var timeoutDialogFragment;
function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:true,dataType:"text",success:function(a){timeoutDialogFragment=a
},error:function(c,a,b){timeoutDialogEnabled=false
}})
}function show_timeout_alert(b){if(!timeoutDialogEnabled){return
}if(!$PBJQ("#portalMask").get(0)){createDHTMLMask(dismiss_session_alert);
$PBJQ("#portalMask").css("z-index",1000)
}if($PBJQ("#timeout_alert_body").get(0)){$PBJQ("#timeout_alert_body span").html(b)
}else{var a=timeoutDialogFragment.replace("{0}",b);
$PBJQ("body").append(a)
}}function toggleShortUrlOutput(b,c,a){if($PBJQ(c).is(":checked")){$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(b),dataType:"text",success:function(d){$PBJQ("."+a).val(d)
}})
}else{$PBJQ("."+a).val(b)
}}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(b){var a=$PBJQ(this).position();
$PBJQ(this).siblings(".Mrphs-directUrl").toggleClass("active").css({left:a.left+"px"});
b.preventDefault()
});
$PBJQ(".Mrphs-directUrl .dropDown_close").click(function(a){$PBJQ(this).parent().toggleClass("active");
a.preventDefault()
})
});
var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");
$PBJQ(a).attr("tabindex","-1").focus()
})
};
$PBJQ(document).ready(function(){var a=0;
$PBJQ(document).scroll(function(c){var b=$PBJQ(this).scrollTop();
if(b>a&&b>90){$PBJQ(".Mrphs-topHeader").addClass("moving");
$PBJQ(".Mrphs-siteHierarchy").addClass("moving");
$PBJQ(".Mrphs-toolsNav__title--current-site").addClass("moving");
$PBJQ(".Mrphs-skipNav__menu").addClass("moving");
$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").addClass("moving")
}else{if(b>90){$PBJQ(".Mrphs-topHeader").removeClass("moving");
$PBJQ(".Mrphs-siteHierarchy").removeClass("moving");
$PBJQ(".Mrphs-toolsNav__title--current-site").removeClass("moving");
$PBJQ(".Mrphs-skipNav__menu").removeClass("moving");
$PBJQ(".Mrphs-sitesNav__menuitem--myworkspace").removeClass("moving")
}}a=b
})
});
var closeAllDropdownMenus=function(){$PBJQ(".Mrphs-sitesNav__menuitem").removeClass("dropdown-is-visible");
$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-visible").removeClass("is-visible");
$PBJQ(".Mrphs-sitesNav__menuitem").find(".is-clicked").removeClass("is-clicked");
$PBJQ(".sitenav-dropdown-overlay").remove()
};
var buildDropdownMenu=function(b,a,g){var i='<ul class="Mrphs-sitesNav__submenu" role="menu">';
var e=parseInt($PBJQ("#linkNav").attr("data-max-tools-int"));
var d=$PBJQ("#linkNav").attr("data-max-tools-anchor");
var c='<li class="Mrphs-sitesNav__submenuitem"><a role="menuitem" href="'+portal.portalPath+"/site/"+a+'" title="'+d+'"><span class="toolMenuIcon icon-sakai--see-all-tools"></span>'+d+"</a></li>";
var f="/direct/site/"+a+"/pages.json";
var h=window.location.pathname.split("/").pop();
$PBJQ.ajax({url:f,dataType:"json",success:function(j){$PBJQ.each(j,function(n,o){if(!o.tools||o.tools.length<=0){return
}var m="";
if(h==o.tools[0].id){m=" is-current"
}if(n<=e){var l;
if(o.toolpopup){var k=' role="menuitem" href="{{tool_url}}?sakai.popup=yes" title="{{item_title}}" onclick="window.open(\'{{item_toolpopupurl}}\');"';
l='<li class="Mrphs-sitesNav__submenuitem" ><a class="Mrphs-sitesNav__submenuitem-icon"'+k+'><span class="toolMenuIcon icon-sakai--{{icon}}"></span></a><a class="Mrphs-sitesNav__submenuitem-title"'+k+">{{item_title}}</a></li>"
}else{var k=' role="menuitem" href="{{tool_url}}" title="{{item_title}}"';
l='<li class="Mrphs-sitesNav__submenuitem{{is_current}}"><a class="Mrphs-sitesNav__submenuitem-icon"'+k+'><span class="toolMenuIcon icon-sakai--{{icon}}"></span></a><a class="Mrphs-sitesNav__submenuitem-title"'+k+">{{item_title}}</a></li>"
}i+=(l.replace(/{{tool_url}}/g,o.tools[0].url).replace(/{{item_title}}/g,o.title).replace(/{{item_toolpopupurl}}/g,o.toolpopupurl).replace(/{{icon}}/g,o.tools[0].toolId.replace(/\./gi,"-")).replace(/{{is_current}}/g,m))
}});
if((j.length-1)>e){i+=c
}i+="</ul>";
i=$PBJQ(i);
b.append(i);
addArrowNavAndDisableTabNav(i);
g(i)
},error:function(l,j,k){}})
};
var setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){if(a.keyCode==27){closeAllDropdownMenus()
}})
});
$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",function(a){if(a.keyCode==40){a.preventDefault();
var b=$PBJQ(this).parent().find(".Mrphs-sitesNav__dropdown");
if(b.data("clicked")){}else{b.data("clicked",true);
b.trigger("click",[true])
}}else{if(a.keyCode==27){a.preventDefault();
closeAllDropdownMenus()
}}});
$PBJQ("ul.Mrphs-sitesNav__menu li .Mrphs-sitesNav__dropdown").click(function(f,b){f.preventDefault();
var h=$PBJQ(f.target);
var a=h.parent(".Mrphs-sitesNav__menuitem");
var g=a.hasClass("dropdown-is-visible");
closeAllDropdownMenus();
if(g){return
}var d=$PBJQ(this);
var c=function(i){d.addClass("is-clicked");
a.addClass("dropdown-is-visible");
i.addClass("is-visible");
if(b){a.find("a.Mrphs-sitesNav__submenuitem-title").first().focus()
}var e=$PBJQ('<div class="sitenav-dropdown-overlay" />');
e.on("click",function(j){closeAllDropdownMenus()
});
$PBJQ("body").prepend(e);
d.removeData("clicked")
};
if(!a.find("ul").length){buildDropdownMenu(a,h.attr("data-site-id"),c)
}else{c(a.find("ul"))
}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__dropdown--hover")
})
};
function addArrowNavAndDisableTabNav(a){a.find("li a").attr("tabindex","-1").keydown(function(f){var d=$PBJQ(f.target);
if(f.keyCode==40){f.preventDefault();
var b=d.closest("li").next();
if(b.length===0||b.find("a.Mrphs-sitesNav__submenuitem-title").length==0){b=a.find("li").first()
}b.find("a.Mrphs-sitesNav__submenuitem-title").focus()
}else{if(f.keyCode==38){f.preventDefault();
var c=d.closest("li").prev();
if(c.length===0){c=a.find("a.Mrphs-sitesNav__submenuitem-title").closest("ul")
}c.find("a.Mrphs-sitesNav__submenuitem-title").focus()
}else{if(f.keyCode==9){closeAllDropdownMenus()
}}}})
}function toggleMinimizeNav(){$PBJQ("body").toggleClass("Mrphs-toolMenu-collapsed");
var b=$PBJQ(this);
var a=$PBJQ(".accessibility-btn-label",b);
b.toggleClass("min max");
if(a.text()==b.data("title-expand")||collapsed){document.cookie="sakai_nav_minimized=false; path=/";
collapsed=false;
a.text(b.data("text-original"));
b.attr("title",(b.data("text-original")));
b.attr("aria-pressed",true)
}else{document.cookie="sakai_nav_minimized=true; path=/";
collapsed=true;
b.data("text-original",a.text());
a.text(b.data("title-expand"));
b.attr("title",(b.data("title-expand")));
b.attr("aria-pressed",false)
}}$PBJQ(".js-toggle-nav").on("click",toggleMinimizeNav);
var collapsed=false;
var $window=$PBJQ(window),$tools=$("#toolMenu"),$bread=$(".Mrphs-siteHierarchy"),padding=$bread.height()+getNumPart($bread.css("padding-top"))+getNumPart($bread.css("padding-bottom"))+$(".Mrphs-topHeader").height();
$PBJQ(document).ready(function(){if(getCookieVal("sakai_nav_minimized")==="true"){$PBJQ(".js-toggle-nav").click();
collapsed=true
}});
$PBJQ(window).scroll(function(){if($("#toolMenuWrap").attr("scrollingToolbarEnabled")!=undefined){var b=$(".pasystem-banner-alerts").height();
var a=($window.height()-(padding+b))>$tools.height()&&($window.scrollTop()>padding);
if($("#toolMenuWrap").css("position")!=="fixed"&&a&&$window.scrollTop()>0){$("#toolMenu").stop().animate({top:$window.scrollTop()+b-padding})
}else{$("#toolMenu").stop().animate({top:0})
}}});
$PBJQ("#toggleSubsitesLink").click(function(c){var b=$PBJQ(this);
if($PBJQ("#subSites").css("display")=="block"){$PBJQ("#subSites").hide();
$PBJQ("#subSites").removeClass("floating")
}else{var a=b.position();
var d=(-1*($PBJQ("#toolMenu").height()-a.top));
$PBJQ("#subSites").css({display:"block",left:a.left+b.width()+6+"px",top:d+"px"});
$PBJQ("#subSites").addClass("floating");
if($PBJQ("#toggleSubsitesLink").position().top<240){$PBJQ("#subSites.floating").addClass("ontop")
}}});
function getCookieVal(d){var c=document.cookie.split(";");
for(var b=0;
b<c.length;
++b){var a=(c[b].substring(0,c[b].indexOf("="))).trim();
if(a===d){return((c[b].split("="))[1]).trim()
}}return"false"
}function getNumPart(b){for(var a=b.length-1;
a>=0;
a--){if(!isNaN(Number(b.charAt(a)))){return Number(b.substring(0,a+1))
}}}function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:false,success:function(g){var f=g.indexOf("<ul");
if(f<1){$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty");
location.reload();
return
}g=g.substr(f);
var e=g;
var b="<li";
var a=0;
for(var d=0;
d<e.length;
d++){if(b==e.substr(d,b.length)){a++
}}if(a>1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("empty").addClass("present")
}else{if(a==1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}else{$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}}$PBJQ("#presenceIframe").html(g);
var c=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");
$PBJQ("#presenceIframe .presenceList li.inChat span").wrap('<a href="'+c+'"></a>');
sakaiLastPresenceTimeOut=setTimeout("updatePresence()",30000)
},error:function(b,a){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",60000)
}})
}function userNavEscHandler(a){if(a.keyCode===27){toggleUserNav(a)
}}function toggleUserNav(b){b.preventDefault();
$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden");
if(!$PBJQ(".Mrphs-userNav__subnav").hasClass("is-hidden")){var a=$PBJQ('<div class="user-dropdown-overlay" />');
a.on("click",function(c){toggleUserNav(c)
});
$PBJQ("body").prepend(a);
$PBJQ(document).on("keyup",userNavEscHandler)
}else{$PBJQ(".user-dropdown-overlay").remove();
$PBJQ(document).off("keyup",userNavEscHandler)
}}$PBJQ("#loginLink1").click(function(a){if($PBJQ(this).attr("data-warning")!==""&&!confirm($PBJQ(this).attr("data-warning"))){a.preventDefault()
}});
$PBJQ(".js-toggle-user-nav a#loginUser > .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);
$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop-btn","#loginLinks").on("click",toggleUserNav);
$PBJQ(document).ready(function(){if($PBJQ(".Mrphs-hierarchy--parent-sites").length>0&&$PBJQ(window).width()<=800){$PBJQ("#content").css("margin-top",(parseInt($PBJQ("#content").css("margin-top").replace("px",""))+$PBJQ(".Mrphs-hierarchy--parent-sites").outerHeight(true))+"px")
}});
function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)
}function f_filterResults(d,b,a){var c=d?d:0;
if(b&&(!c||(c>b))){c=b
}return a&&(!c||(c>a))?a:c
}$PBJQ(document).ready(function(){$PBJQ("input, textarea","#content").each(function(){if($PBJQ(this).prop("disabled")){$PBJQ(this).parent("label").addClass("disabled")
}});
$PBJQ(document).keyup(function(a){if(a.keyCode==27){if(!$PBJQ("#selectSiteModal").hasClass("outscreen")){$PBJQ("#otherSitesMenu .otherSitesMenuClose").trigger("click")
}$PBJQ(".Mrphs-directUrl__dropDown").each(function(){if($PBJQ(this).hasClass("active")){$PBJQ(this).find(".dropDown_close").trigger("click")
}});
$PBJQ(".fip-icon-up-dir").trigger("click");
$PBJQ(".navigatePanelControls .close").trigger("click")
}})
});
$PBJQ(document).ready(function(){if($PBJQ("#loginLink2").length==1){$PBJQ("#loginLink2").click(function(a){$PBJQ("body").append('<div id="Mrphs-xlogin-container" />');
$PBJQ("#Mrphs-xlogin-container").load("/portal/xlogin #Mrphs-xlogin",function(){$PBJQ("#Mrphs-xlogin-container").addClass("loaded");
$PBJQ("#Mrphs-xlogin").addClass("loadedByAjax");
$PBJQ("#eid").focus()
});
$PBJQ(".Mrphs-portalWrapper").addClass("blurry");
$PBJQ("body").append('<div id="loginPortalMask" />');
$PBJQ("#loginPortalMask").bgiframe();
$PBJQ("#loginPortalMask").click(function(){$PBJQ("#loginPortalMask").remove();
$PBJQ("#Mrphs-xlogin-container").remove();
$PBJQ(".Mrphs-portalWrapper").removeClass("blurry")
});
a.preventDefault()
})
}});